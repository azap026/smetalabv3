# Руководство по локальному запуску в Docker

Этот проект настроен для работы в Docker. Это гарантирует, что приложение будет работать одинаково на любом компьютере.

## Предварительные требования

- **Docker Desktop** (запущенный)
- **Node.js и pnpm** (для запуска миграций с хоста)

## Быстрый старт (на новом компьютере)

1.  **Настройте окружение:**
    Скопируйте файл примера настроек:
    ```bash
    cp .env.docker.example .env
    ```
    *Примечание: Если вы хотите использовать специфические API ключи (Stripe, OpenAI), отредактируйте `.env`.*

2.  **Запустите контейнеры:**
    ```bash
    npm run docker:up
    ```
    Это соберет приложение и запустит базу данных. Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000).

3.  **Примените схему базы данных:**
    База данных запустится пустой. Чтобы создать таблицы, выполните:
    ```bash
    # Убедитесь что в вашем .env прописан правильный POSTGRES_URL для хоста:
    # POSTGRES_URL=postgresql://smetalab_user:smetalab_password@localhost:5432/smetalab_local_db
    pnpm db:migrate
    ```

## Перенос данных на другой компьютер

Если у вас есть дамп базы данных (`local_backup.sql`), вы можете восстановить его:

```bash
cat local_backup.sql | docker exec -i smetalab-db psql -U smetalab_user -d smetalab_local_db
```

## Работа с переменными окружения

Файл `docker-compose.yml` настроен так, чтобы брать значения из вашего локального файла `.env`. 

**Важно:** Переменные `NEXT_PUBLIC_*` вшиваются в приложение на этапе сборки Docker-образа. Если вы изменили их в `.env`, вам нужно пересобрать образ:
```bash
npm run docker:up
```

## Основные команды

| Команда | Описание |
| :--- | :--- |
| `npm run docker:up` | Собрать и запустить (в фоне) |
| `docker-compose down` | Остановить и удалить контейнеры |
| `docker-compose logs -f app` | Просмотр логов приложения |
| `docker-compose restart app` | Перезапустить только приложение |
