# Smetalab v1.0.2

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–∞ **Next.js**, —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –º—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å—é, –≥–∏–±—Ä–∏–¥–Ω—ã–º AI-–ø–æ–∏—Å–∫–æ–º –∏ —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π.

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: [https://github.com/azap026/smetalabv3](https://github.com/azap026/smetalabv3)**

---

## üèõ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ü—Ä–∞–≤–∏–ª–∞ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–í–∞–∂–Ω–æ!)

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–æ–¥–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, —á—Ç–æ–±—ã –ø—Ä–æ–µ–∫—Ç –æ—Å—Ç–∞–≤–∞–ª—Å—è —á–∏—Å—Ç—ã–º –∏ –Ω–∞–¥–µ–∂–Ω—ã–º.

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ Multi-tenancy (–°–ª–æ–π –ë–î)
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø–∞—Å–Ω–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å `where(eq(table.tenantId, ...))` –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ. –ú–æ–∂–Ω–æ –∑–∞–±—ã—Ç—å –∏ ¬´—Å–ª–∏—Ç—å¬ª –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–π –∫–æ–º–∞–Ω–¥–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ–ª–ø–µ—Ä `withActiveTenant` –∏–∑ `lib/db/queries.ts`.
- ‚úÖ **–ö–∞–∫ –ù–£–ñ–ù–û:**
  ```typescript
  // –•–µ–ª–ø–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç: .where(and(eq(tenantId, ...), isNull(deletedAt)))
  const data = await db.select().from(materials).where(withActiveTenant(materials, teamId));
  ```
- ‚ùå **–ö–∞–∫ –ù–ï–õ–¨–ó–Ø:**
  ```typescript
  // –ù–µ –ø–∏—à–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –µ—Å—Ç—å tenantId –∏ deletedAt
  .where(and(eq(materials.tenantId, id), isNull(materials.deletedAt))) 
  ```

### 2. –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–°–ª–æ–π –°–µ—Ä–≤–∏—Å–æ–≤)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ 100 —Å—Ç—Ä–æ–∫ –Ω–∞ 50-–π –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞, –≤ –±–∞–∑–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è ¬´–º—É—Å–æ—Ä¬ª (–ø–æ–ª–æ–≤–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö).

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ –∑–∞–ø–∏—Å–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.
- ‚úÖ **–ö–∞–∫ –ù–£–ñ–ù–û:**
  ```typescript
  await db.transaction(async (tx) => {
    // –ï—Å–ª–∏ –∑–¥–µ—Å—å —É–ø–∞–¥–µ—Ç –æ—à–∏–±–∫–∞, –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ tx –æ—Ç–∫–∞—Ç—è—Ç—Å—è –Ω–∞–∑–∞–¥
    await tx.insert(materials).values(rows);
    await tx.insert(logs).values(logEntry);
  });
  ```
- ‚ö†Ô∏è **–ü—Ä–∞–≤–∏–ª–æ:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∂–∏–≤–µ—Ç –≤ `lib/services/`. Server Actions –ª–∏—à—å –≤—ã–∑—ã–≤–∞—é—Ç —ç—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã.

### 3. –ß–∏—Å—Ç—ã–π –§—Ä–æ–Ω—Ç–µ–Ω–¥ (–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è)
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã –ø–æ 500 —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–µ–µ —á–∏—Ç–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª—è–π—Ç–µ –∫–æ–¥ –Ω–∞ 3 —É—Ä–æ–≤–Ω—è:
1.  **–•—É–∫–∏ (hooks/):** –í—Å—è ¬´—á–µ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞¬ª ‚Äî –∑–∞–ø—Ä–æ—Å—ã –∫ API, —Å—Ç–µ–π—Ç—ã, —Ç–∞–π–º–µ—Ä—ã.
2.  **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (components/):** –¢–æ–ª—å–∫–æ UI (–∫–Ω–æ–ø–∫–∏, —Ç–∞–±–ª–∏—Ü—ã, –≤–µ—Ä—Å—Ç–∫–∞). –û–Ω–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ props.
3.  **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (client.tsx):** –°–æ–±–∏—Ä–∞–µ—Ç —Ö—É–∫–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–º–µ—Å—Ç–µ.

> **–°–æ–≤–µ—Ç:** –ï—Å–ª–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –±–æ–ª—å—à–µ 2-3 `useState` –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–µ `useEffect` ‚Äî –≤—ã–Ω–æ—Å–∏—Ç–µ —ç—Ç–æ –≤ –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫.

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ `null` –∏–ª–∏ —Å—Ç—Ä–æ–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ä–µ–∫—Ç `Result` –∏–∑ `lib/utils/result.ts`.
–í—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ **Sentry** —á–µ—Ä–µ–∑ –æ–±–µ—Ä—Ç–∫—É `safeAction`.

---

### üèÜ –ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (—á–µ–∫-–ª–∏—Å—Ç –Ω–∞ –∑–∞–≤—Ç—Ä–∞)
1. **–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –ë–î?** -> –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Ç–∞–º `tenantId`. –ï—Å–ª–∏ –¥–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `withActiveTenant`.
2. **–ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (Insert/Update)?** -> –î–µ–ª–∞–π —ç—Ç–æ –≤ `lib/services/` –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ `db.transaction`.
3. **–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∏–ª–∏ –ø–æ–ª–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É?** -> –ü–æ—Å–º–æ—Ç—Ä–∏, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ —Ö—É–∫. –ù–µ —Ä–∞–∑–¥—É–≤–∞–π `.tsx` —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
4. **–î–æ–±–∞–≤–∏–ª –Ω–æ–≤—É—é —Ñ–∏—á—É?** -> –ó–∞–ø—É—Å—Ç–∏ `pnpm type-check`. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å `any` ‚Äî –∏—Å–ø—Ä–∞–≤–ª—è–π.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

- `app/(workspace)/app/`: –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.
- `app/actions/`: Server Actions (–æ–±–µ—Ä—Ç–∫–∏ `safeAction` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π).
- `lib/db/`: –°—Ö–µ–º–∞ Drizzle –∏ –º–∏–≥—Ä–∞—Ü–∏–∏.
- `lib/services/`: **–Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã**. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, API OpenAI.
- `lib/auth/`: –õ–æ–≥–∏–∫–∞ RBAC –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞.
- `components/ui/`: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Shadcn/UI (–±–∞–∑–æ–≤—ã–µ –±–ª–æ–∫–∏).

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Framework**: Next.js 14+ (App Router)
- **Database**: Postgres (Neon/Render) + Drizzle ORM
- **AI**: OpenAI (–º–æ–¥–µ–ª—å `text-embedding-3-small`) –¥–ª—è —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.
- **UI**: Tailwind CSS + Shadcn/UI.
- **Monitoring**: Sentry (Error tracking & Performance)

## üê≥ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker

–î–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –Ω–æ–≤–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏–ª–∏ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker. –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–¥–µ—Å—å:
üëâ **[README.docker.md](./README.docker.md)**

## üö¶ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç


1. `pnpm install` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
2. `cp .env.example .env` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (Postgres, OpenAI, Stripe).
3. `pnpm db:migrate` ‚Äî –Ω–∞–∫–∞—Ç —Å—Ö–µ–º—ã –Ω–∞ –ë–î.
4. `pnpm dev` ‚Äî –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞.

## üß™ –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
pnpm type-check    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º)
pnpm lint          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞
pnpm test          # –Æ–Ω–∏—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```
